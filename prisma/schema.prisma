datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}

model Swap {
  id                 String   @id @default(uuid())
  swapId             Bytes    @unique
  initiator          String
  resolver           String
  amount             String
  hashlock           Bytes
  timelock           Int
  stellarAccount     String
  state              String   // INITIATED, LOCKED, COMPLETED, REFUNDED
  enablePartialFill  Boolean
  minimumFill        String?
  filledAmount       String
  merkleRoot         Bytes?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Resolver {
  address            String   @id
  endpoint           String
  stake              Decimal  @db.Decimal(30, 0)
  successfulSwaps    Int
  totalSwaps         Int
  reputation         Int
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model PartialFill {
  id                 String   @id @default(uuid())
  swapId             String
  secretIndex        Int
  secretUsed         Boolean
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([swapId])
  @@unique([swapId, secretIndex])
}
